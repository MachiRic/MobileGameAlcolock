<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="font/fontLoader.css">
    <title>MobileGameAlcolock demo</title>
    <style>
        body {
            margin: 0;
            background: rgb(255, 255, 255);
        }
    </style>
    <!--Import the phaser framework-->
    <!--<script src="//cdn.jsdelivr.net/phaser/2.6.2/phaser.js"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/phaser-ce@2.16.1/build/phaser.js"></script>

    <!--Import the other files the game consists of-->
    <script src="./src/webgazer.js" type="text/javascript"> </script>
    <script src="./src/Boot.js"></script>
    <script src="./src/Preloader.js"></script>
    <script src="./src/MainMenu.js"></script>
    <script src="./src/Howto.js"></script>
    <script src="./src/Game.js"></script>
    <script src="./src/Result.js"></script>
</head>

<body>
    <div id = "parentDiv">
    <script>
        window.applyKalmanFilter = true;

        window.onload = async function () {

            webgazer.params.showVideoPreview = true;
            const webgazerInstance = await webgazer.setRegression('ridge') /* currently must set regression and tracker */
                .setTracker('TFFacemesh')
                .begin();
            webgazerInstance.showPredictionPoints(true); /* shows a square every 100 milliseconds where current prediction is */

            webgazer.setGazeListener(function (data, elapsedTime) {
                if (data) {

                    Ball.xprediction = data.x;
                    Ball.yprediction = data.y;

                    //console.log(Ball.xprediction);
                    //console.log(Ball.yprediction);
                }
                //console.log(elapsedTime);
            });
        };


        (function () {
        //responsive
        var oriResWidth = 375 * 2;
        //var resWidth = window.innerWidth * window.devicePixelRatio;
        //var resHeight = window.innerHeight * window.devicePixelRatio;
        var resWidth = oriResWidth;
        var resHeight;
        if (window.innerWidth / window.innerHeight >= 0.7) {
            resHeight = 667 * 2;
        }
        else {
            resHeight = window.innerHeight / window.innerWidth * resWidth;
        }
        //console.log(window.innerWidth);
        //console.log(window.devicePixelRatio);
        //console.log(resWidth);
        var game = new Phaser.Game(resWidth, resHeight, Phaser.AUTO, 'game');

        //Ball.realWidth = game.scale.width;
        //Ball.realHeight = game.scale.width;
        //console.log(game.scale.width);
        //console.log(game.scale.width);

        Ball._WIDTH = resWidth;
        Ball._HEIGHT = resHeight;
        Ball.scaleFactor = resWidth / 750.0;
        game.state.add('Boot', Ball.Boot);
        game.state.add('Preloader', Ball.Preloader);
        game.state.add('MainMenu', Ball.MainMenu);
        game.state.add('Howto', Ball.Howto);
        game.state.add('Game', Ball.Game);
        game.state.add('Result', Ball.Result);
        game.state.start('Boot');
        })();
    </script>
    </div>
</body>

</html>